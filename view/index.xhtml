<script type="text/javascript" src="/flowplayer/flowplayer-3.1.4.min.js"></script>
<?r unless session[:loggedin] ?>
<form id="login" action="/" method="POST">
	<label for="id">userid: </label><input id="id" name="id"/><br/>
	<label for="passw">password: </label><input type="password" id="passw" name="passwd"/>
	<input type="submit">
	<script type="text/javascript"> //<![CDATA[
		$(function(){
			$('#id').select();
		});
	//]]></script>
</form>
<?r else ?>
<table border='1'>
	<thead>
		<tr><th>date/time</th><td>CH</td><td>title</td><td>delete</td></tr>
	</thead>
	<tbody>
		<?r @items.each do |item| ?>
		<?r next unless item ?>
		<tr>
			<th>#{item[:date]} #{item[:hour]}:#{item[:min]}</th>
			<td>#{item[:ch]}</td>
			<td>
				<div class="player" href="#{item[:filename]}">
					<a href="#">#{item[:title]}</a>
				</div>
			</td>
			<td>
				<a href="#{item[:mpgname]}">download</a>
				<button id="#{item[:filename]}" class='delete' name='delete'>delete</button>
			</td>
		</tr>
		<?r end ?>
	</tbody>
</table>
<script type="text/javascript"> //<![CDATA[
	$(function(){
		flowplayer(".player", "flowplayer/flowplayer-3.1.3.swf");
		$(".player").click(function(){
			$(".playing").removeClass("playing");
			$(this).addClass("playing")
		});
		$('.delete').click(function(){
			var fn = $(this).attr('id');
			if (confirm("Delete " + fn + "?")) {
			  document.location = '/delete?id=' + fn;
			}
		});
	});
	//]]></script>
<?r end ?>
