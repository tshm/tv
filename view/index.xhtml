<script type="text/javascript" src="/flowplayer/flowplayer-3.1.4.min.js"></script>
<?r unless session[:loggedin] ?>
<form id="login" action="/" method="POST">
	<label for="id">userid: </label><input id="id" name="id"/><br/>
	<label for="passw">password: </label><input type="password" id="passw" name="passwd"/>
	<input type="submit">
	<script type="text/javascript"> //<![CDATA[
		$(function(){
			$('#id').select();
		});
	//]]></script>
</form>
<?r else ?>
<table border='1'>
	<thead>
		<tr><th>date/time</th><td>CH</td><td>title</td><td>download / delete</td></tr>
	</thead>
	<tbody>
		<?r @items.each do |item| ?>
		<?r next unless item ?>
		<tr>
			<th>#{item[:date]} #{item[:hour]}:#{item[:min]}</th>
			<td>#{item[:ch]}</td>
			<td>
				<div class="player">
					<a class="link" href="#{item[:filename]}">#{item[:title]}</a>
					<a class="2x" href="#">2x</a>
				</div>
			</td>
			<td>
				<a class='download' href="#{item[:mpgname]}">download</a> / 
				<a class='delete' href="/delete?pathname=#{item[:filename]}">delete</a>
			</td>
		</tr>
		<?r end ?>
	</tbody>
</table>
<script type="text/javascript"> //<![CDATA[
	$(function(){
		$('.player').each(function(){
			var container = $(this);
			var url = $('a.link', this).attr('href');
			container.flowplayer("flowplayer/flowplayer-3.1.3.swf", {
				clip: { url: url, provider: 'nginx' },
				plugins: { nginx: { url: '/flowplayer/flowplayer.pseudostreaming-3.1.3.swf' } }
			});
		});
		$('a.link').click(function(){
			$(".playing").removeClass("playing").removeClass("playing-2x");
			$(this).parent().addClass("playing")
		});
		$('a.2x').click(function(){
			$(".playing").removeClass("playing").removeClass("playing-2x");
			$(this).parent().addClass("playing-2x")
		});
	});
	//]]></script>
<?r end ?>
