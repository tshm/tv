<script type="text/javascript" src="/flowplayer/flowplayer-3.1.4.min.js"></script>
<div id='control'>
	<button id='start'>|&lt;</button>
	<button id='revL'>&lt;&lt;</button>
	<button id='rev'>&lt;</button>
	<button id='fwd'>&gt;</button>
	<button id='fwdL'>&gt;&gt;</button>
</div>
<table id='list_table' border='1'>
	<thead>
		<tr>
			<th><a href="/?sort=time">date/time</a></th>
			<td><a href="/?sort=ch">CH</a></td>
			<td><a href="/?sort=title">title</a></td>
			<td>download / delete</td>
		</tr>
	</thead>
	<tbody>
		<?r @items.each do |item| ?>
		<?r next unless item && item.time ?>
		<tr>
			<th>#{item.time.strftime("%Y/%m/%d %H:%M")}</th>
			<td>#{item.ch}</td>
			<td>
				<div class="player">
					<a class="link" href="#{item.flvname}">#{item.title}</a>
					<a class="2x" href="#">2x</a>
				</div>
			</td>
			<td>
				<a class='download' href="#{item.mpgname}">download</a> / 
				<a class='delete' href="/delete?pathname=#{item.flvname}">delete</a>
			</td>
		</tr>
		<?r end ?>
	</tbody>
</table>
<script type="text/javascript"> //<![CDATA[
	$(function(){
		var control = $('#control').remove();
		$('.player').each(function(){
			var container = $(this);
			var url = $('a.link', this).attr('href');
			container.flowplayer("flowplayer/flowplayer-3.1.3.swf", {
				clip: { url: url, provider: 'nginx' },
				plugins: { nginx: { url: '/flowplayer/flowplayer.pseudostreaming-3.1.3.swf' } }
			});
		}).click(function(e){
			//console.log( e.target );
			$(".playing").removeClass("playing").removeClass("playing-2x");
			if ("2x" == $(e.target).attr('class')) {
				$(this).addClass("playing-2x")
			} else {
				$(this).addClass("playing")
			}
			$(this).after(control);
			control.click(function(e){
				var player = $f();
				var time = player.getTime();
				switch (e.target.id) {
				case "start": time = 0.0; break;
				case "revL": time -= 30.0; break;
				case "rev": time -= 10.0; break;
				case "fwd": time += 10.0; break;
				case "fwdL": time += 30.0; break;
				}
				console.log(time);
				player.seek(time);
			});
		});
	});
//]]></script>
<!-- vim: foldmethod=indent -->
